<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Woody - Carpenter Website Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Roboto:wght@500;700;900&display=swap" rel="stylesheet"> 

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->

     <!-- Navbar Start -->
    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0">
        <a href="index.html" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
            <h2 class="m-0 text-primary">WooDY</h2>
        </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto p-4 p-lg-0">
                <a href="index.html" class="nav-item nav-link active">Home</a>
                <!-- <a href="about.html" class="nav-item nav-link">About</a> -->
                <a href="project.html" class="nav-item nav-link">Acidentes em Portugal</a>
                  <!-- <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                    <div class="dropdown-menu fade-up m-0">
                        <a href="feature.html" class="dropdown-item">Feature</a>
                        <a href="quote.html" class="dropdown-item">Free Quote</a>
                        <a href="team.html" class="dropdown-item">Our Team</a>
                        <a href="testimonial.html" class="dropdown-item">Testimonial</a>
                        <a href="404.html" class="dropdown-item">404 Page</a>
                    </div>
                </div> -->
                 <!-- <a href="contact.html" class="nav-item nav-link">Contact</a> -->
            </div>
        </div>
    </nav>
    <!-- Navbar End -->

     <!-- About Start -->
     <div class="container-fluid bg-light overflow-hidden px-lg-0">
        <div class="container acidentes_portugal px-lg-0">
            <h1 class="text-dark mb-4 text-center mt-4 fs-2">Acidentes em Portugal</h1>
            <div class="row g-0 mx-lg-0">
                <div class="col-lg-6 ps-lg-0" style="min-height: 800px;">
                    <div class="chart-container">
                        <div id="yearFilter"></div>
                        <div id="chartContainer"></div>
                    </div>
                
                    <script>
                        // Initial data load and visualization
                        d3.csv("data/PORDATA_Acidentes-por-tipo-de-via.csv")
                        .then(draw)
                        .catch(function(err) {
                            console.log(err);
                        });
                
                        const yearFilter = document.getElementById("yearFilter");
                        const years = [2007,2008,2009,2010,2011,2012, 2013, 2014, 2015,2016,2017,2018,2019,2020,2021,2022];
                
                        for (const year of years) {
                            const checkbox = document.createElement("input");
                            checkbox.type = "checkbox";
                            checkbox.value = year;
                
                            const label = document.createElement("label");
                            label.textContent = year;
                            label.appendChild(checkbox);
                
                            const checkboxRow = document.createElement("div");
                            checkboxRow.classList.add("checkbox-row");
                            checkboxRow.appendChild(label);
                
                            yearFilter.appendChild(checkboxRow);
                        }
                
                        function draw(data) {
                
                            const yearFilter = d3.select("#yearFilter");
                
                            yearFilter.on("change", () => {
                                const selectedYears = [];
                                yearFilter.selectAll(".yearCheckbox:checked").each((d) => {
                                    selectedYears.push(d.value);
                                });
                            });
                
                            draw_stacked_bar_chart();
                            drawPieChart();
                        }
                        
                
                        // Grafico de barras agrupado num respetivo ano
                        async function draw_Acidentes_via_porAno() {
                            const width = 800;
                            const height = 600;
                            const marginLeft = 40;
                            const marginRight = 10;
                            const marginBottom = 40; // Aumente a margem inferior para acomodar os rótulos do eixo y
                
                            const data = await d3.csv("data/ansr_dados_tipo-de-via.csv", d3.autoType);
                            const data2007 = data.filter(d => d.ano === 2007);
                
                            // Configuração das escalas
                            const x = d3.scaleBand()
                                .domain(data2007.map(d => d.Tipo_de_via))
                                .rangeRound([marginLeft, width - marginRight])
                                .paddingInner(0.1);
                
                            const y = d3.scaleLinear()
                                .domain([0, d3.max(data2007, d => d3.max([d.VM, d.FG, d.FL]))])
                                .range([height - marginBottom, 0]);
                
                            const categories = ["VM", "FG", "FL"];
                            const color = d3.scaleOrdinal()
                                .domain(categories)
                                .range(d3.schemeCategory10);
                
                            const svg = d3.select("#chartContainer").append("svg")
                                .attr("width", width)
                                .attr("height", height);
                
                            // Itera sobre as categorias
                            categories.forEach((categoria, i) => {
                                // Seleciona os dados correspondentes à categoria
                                const dataCategoria = data2007.map(d => ({
                                    categoria: categoria,
                                    value: d[categoria],
                                    tipoDeVia: d.Tipo_de_via
                                }));
                
                                console.log(dataCategoria);
                
                
                                // Cria as barras para a categoria
                                svg.selectAll(".bar-" + categoria)
                                    .data(dataCategoria)
                                    .enter().append("rect")
                                    .attr("class", "bar bar-" + categoria)
                                    .attr("x", d => x(d.tipoDeVia) + x.bandwidth() / categories.length * i)
                                    .attr("y", d => y(d.value))
                                    .attr("width", x.bandwidth() / categories.length) // Ajusta a largura
                                    .attr("height", d => height - marginBottom - y(d.value))
                                    .attr("fill", color(categoria));
                            });
                
                            // Adiciona eixos
                            svg.append("g")
                                .attr("transform", `translate(0,${height - marginBottom})`)
                                .call(d3.axisBottom(x))
                                .call(g => g.selectAll(".domain").remove());
                
                            svg.append("g")
                                .attr("transform", `translate(${marginLeft},0)`)
                                .call(d3.axisLeft(y).ticks(5))
                                .call(g => g.selectAll(".domain").remove());
                        }
                
                        // Grafico de barras agrupado num respetivo ano
                        async function draw_stacked_bar_chart() {
                            const width = 800;
                            const height = 600;width
                            const marginLeft = 40;
                            const marginRight = 10;
                            const marginBottom = 40; // Aumente a margem inferior para acomodar os rótulos do eixo y
                
                            const data = await d3.csv("data/ansr_dados_tipo-de-via.csv", d3.autoType);
                            const data2007 = data.filter(d => d.ano === 2007);
                
                            // Configuração das escalas
                            const x = d3.scaleBand()
                                .domain(data2007.map(d => d.Tipo_de_via))
                                .rangeRound([marginLeft, width - marginRight])
                                .paddingInner(0.1);
                
                            const y = d3.scaleLinear()
                                .domain([0, d3.max(data2007, d => d3.max([d.VM, d.FG, d.FL]))])
                                .range([height - marginBottom, 0]);
                
                            const categories = ["VM", "FG", "FL"];
                            // Configuração da escala de cores
                            const color = d3.scaleOrdinal()
                                .domain(categories)
                                .range(d3.schemeCategory10);
                
                            const svg = d3.select("#chartContainer").append("svg")
                                .attr("width", width)
                                .attr("height", height);
                
                            // Transpose os dados para ter uma matriz de dados empilhados
                            const stackedData = d3.stack()
                                .keys(categories)
                                .order(d3.stackOrderNone)
                                .offset(d3.stackOffsetNone)(data2007);
                
                            // Adiciona barras empilhadas ao SVG
                            svg.selectAll(".bar")
                                .data(stackedData)
                                .enter().append("g")
                                .attr("class", d => "bar " + d.key)
                                .attr("fill", d => color(d.key))
                                .selectAll("rect")
                                .data(d => d)
                                .enter().append("rect")
                                .attr("x", d => x(d.data.Tipo_de_via))
                                .attr("y", d => y(d[1]))
                                .attr("height", d => y(d[0]) - y(d[1]))
                                .attr("width", x.bandwidth());
                
                            // Adiciona eixos
                            svg.append("g")
                                .attr("transform", `translate(0,${height - marginBottom})`)
                                .call(d3.axisBottom(x))
                                .call(g => g.selectAll(".domain").remove());
                
                            svg.append("g")
                                .attr("transform", `translate(${marginLeft},0)`)
                                .call(d3.axisLeft(y).ticks(5))
                                .call(g => g.selectAll(".domain").remove());
                        }
                
                
                
                
                        function drawPieChart() {
                            const w = 150;
                            const h = 150;
                            const radius = Math.min(w, h) / 2;
                
                            const data = [
                                { key: 'VM', value: 1 / 3 * 100 },
                                { key: 'FL', value: 1 / 3 * 100 },
                                { key: 'FG', value: 1 / 3 * 100 }
                            ];
                
                            const color = d3.scaleOrdinal(d3.schemeCategory10);
                
                            const svg = d3.select('body').append('svg')
                                .attr('class', 'pie-chart') // Adicione a classe aqui
                                .attr('width', w+100)
                                .attr('height', h+100)
                                .append('g')
                                .attr('transform', `translate(${w / 2+10}, ${h / 2})`);
                
                            const pie = d3.pie().value(d => d.value);
                            const data_ready = pie(data);
                
                            const arcGenerator = d3.arc()
                                .innerRadius(0)
                                .outerRadius(radius);
                
                            const arcs = svg.selectAll('whatever')
                                .data(data_ready)
                                .enter()
                                .append('g')
                                .attr('class', 'arc');
                
                            arcs.append('path')
                                .attr('d', arcGenerator)
                                .style('fill', d => color(d.data.key))
                                .style('stroke', "black")
                                .style('stroke-width', '2px')
                                //.style('opacity', 0.7);
                
                            // Legend
                            const legend = svg.selectAll('.legend')
                                .data(data_ready)
                                .enter()
                                .append('g')
                                .attr('class', 'legend')
                                .attr('transform', (_, i) => `translate(-50, ${i * 20})`);
                
                            legend.append('rect')
                                .attr('x', w+18)
                                .attr('width', 18)
                                .attr('height', 18)
                                .style('fill', d => color(d.data.key));
                
                            legend.append('text')
                                .attr('x', w+10)
                                .attr('y', 9)
                                .attr('dy', '.35em')
                                .style('text-anchor', 'end')
                                .text(d => d.data.key);
                        }
                
                        function draw_acidentes_total_via(data) {
                            let w = 1000, h = 600; // width and height
                            
                            let svg = d3.select('body').append('svg')
                            .attr('width', w)
                            .attr('height', h);
                            
                            
                            // The scale does not have extent, as it need all the values
                            let x_extent = data.map(d => d.Ano);
                            let x_scale = d3.scalePoint()
                                .range([  margin ,w- margin])
                                .domain(x_extent);
                                
                            let y_extent = d3.extent(data, d => d.Total);
                            let y_scale = d3.scaleLinear()
                            .range([h - margin, margin])
                            .domain([0, y_extent[1]]);
                            
                            let circles_Total = svg.selectAll("circle")
                            .data(data)
                            .join("circle")
                            .attr("cx", d => x_scale(d.Ano))
                            .attr("cy", d => y_scale(d.Total))
                            .attr("r",  4)
                            .attr("class","Total")
                
                            let x_axis=d3.axisBottom(x_scale);
                            let y_axis=d3.axisLeft(y_scale);
                            
                            d3.select("svg")
                                .append("g")
                                .attr("class","x axis")
                                .attr("transform","translate(0," + ( h -margin ) + ")")
                                .call(x_axis)
                
                            d3.select("svg")
                                .append("g")
                                .attr("class","y axis")
                                .attr("transform","translate(" + margin + ",0)")
                                .call(y_axis)                   
                            
                
                            let line=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.Total))
                            d3.select("svg")
                                .append("path")
                                .attr("d",line(data))
                                .attr("class","Total")
                                
                            svg.append("text")
                                .attr("x", (w / 2))             
                                .attr("y",  (margin / 2))
                                .attr("text-anchor", "middle")  
                                    .text("Acidentes por tipo de via (total por agora)");
                                
                        }
                        
                
                        function draw_acidents_via(data) {
                            let w = 1000, h = 600; // width and height
                            
                            let svg = d3.select('body').append('svg')
                            .attr('width', w)
                            .attr('height', h);
                            
                            
                            // The scale does not have extent, as it need all the values
                            let x_extent = data.map(d => d.Ano);
                            let x_scale = d3.scalePoint()
                                .range([  margin ,w- margin])
                                .domain(x_extent);
                                
                            let y_extent = d3.extent(data, d => d.Arruamento);
                            let y_scale = d3.scaleLinear()
                            .range([h - margin, margin])
                            .domain([0, y_extent[1]]);
                            
                
                            let x_axis=d3.axisBottom(x_scale);
                            let y_axis=d3.axisLeft(y_scale);
                
                            svg.append("g")
                            .attr("class","x axis")
                            .attr("transform","translate(0," + ( h -margin ) + ")")
                            .call(x_axis)
                
                            svg.append("g")
                                .attr("class","y axis")
                                .attr("transform","translate(" + margin + ",0)")
                                .call(y_axis) 
                            
                            svg.append("text")
                                .attr("x", (w / 2))             
                                .attr("y",  (margin / 2))
                                .attr("text-anchor", "middle")  
                                .text("Acidentes por tipo de via ");
                                        
                            let circles_Arruamento = svg.selectAll(".Arruamento")
                                .data(data)
                                .join("circle")
                                .attr("cx", d => x_scale(d.Ano))
                                .attr("cy", d => y_scale(d.Arruamento))
                                .attr("r",  4)
                                .attr("class","Arruamento")
                
                            /// todo: definir detline1 e fazco uma linha d3 line e depois a partir do svg appendar a linha
                            let line_arruamento=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.Arruamento))
                
                            svg.append("path")
                                .attr("d",line_arruamento(data))
                                .attr("class","Arruamento");
                            
                            let circles_Autoestrada = svg.selectAll(".Autoestrada")
                                .data(data)
                                .join("circle")
                                .attr("cx", d => x_scale(d.Ano))
                                .attr("cy", d => y_scale(d.Autoestrada))
                                .attr("r",  4)
                                .attr("class","Autoestrada")
                            
                            let line_autoestrada=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.Autoestrada))
                            
                            svg.append("path")
                                .attr("d",line_autoestrada(data))
                                .attr("class","Autoestrada");
                        
                
                            // Dados acerca da estrada municipal
                            let circles_municipal = svg.selectAll(".Municipal")
                                .data(data)
                                .join("circle")
                                .attr("cx", d => x_scale(d.Ano))
                                .attr("cy", d => y_scale(d.Emunicipal))
                                .attr("r",  4)
                                .attr("class","Municipal")
                
                            let line_municipal=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.Emunicipal))
                            svg.append("path")
                                .attr("d",line_municipal(data))
                                .attr("class","Municipal");
                            
                            // Dados acerca da estrada Nacional
                            let circles_Nacional = svg.selectAll(".Nacional")
                                .data(data)
                                .join("circle")
                                .attr("cx", d => x_scale(d.Ano))
                                .attr("cy", d => y_scale(d.Enacional))
                                .attr("r",  4)
                                .attr("class","Nacional")
                            
                            let line_Nacional=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.Enacional))
                            svg.append("path")
                                .attr("d",line_Nacional(data))
                                .attr("class","Nacional");
                
                
                            // Dados acerca da IPIC
                            let circles_IPIC = svg.selectAll(".IPIC")
                                .data(data)
                                .join("circle")
                                .attr("cx", d => x_scale(d.Ano))
                                .attr("cy", d => y_scale(d.IPIC))
                                .attr("r",  4)
                                .attr("class","IPIC")
                
                            let line_IPIC=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.IPIC))
                            svg.append("path")
                                .attr("d",line_IPIC(data))
                                .attr("class","IPIC");
                
                                
                            // Dados acerca da Outras vias
                            let circles_Outras_vias = svg.selectAll(".Outras_vias")
                                .data(data)
                                .join("circle")
                                .attr("cx", d => x_scale(d.Ano))
                                .attr("cy", d => y_scale(d.Outras))
                                .attr("r",  4)
                                .attr("class","Outras_vias")
                           
                            let line_Outras_vias=d3.line()
                                .x((d,i)=>x_scale(d.Ano))
                                .y((d,i)=>y_scale(d.Outras))
                
                            svg.append("path")
                                .attr("d",line_Outras_vias(data))
                                .attr("class","Outras_vias");
                            }
                    </script>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <button type="button" onclick="myFunction()" class="btn btn-primary py-2 position-absolute top-0 mt-4" style="right: -700px;">Tipo de via</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- About End -->  


        

    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer mt-5 pt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Address</h4>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>123 Street, New York, USA</p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>+012 345 67890</p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i>info@example.com</p>
                    <div class="d-flex pt-2">
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-youtube"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Services</h4>
                    <a class="btn btn-link" href="">General Carpentry</a>
                    <a class="btn btn-link" href="">Furniture Remodeling</a>
                    <a class="btn btn-link" href="">Wooden Floor</a>
                    <a class="btn btn-link" href="">Wooden Furniture</a>
                    <a class="btn btn-link" href="">Custom Carpentry</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Quick Links</h4>
                    <a class="btn btn-link" href="">About Us</a>
                    <a class="btn btn-link" href="">Contact Us</a>
                    <a class="btn btn-link" href="">Our Services</a>
                    <a class="btn btn-link" href="">Terms & Condition</a>
                    <a class="btn btn-link" href="">Support</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-light mb-4">Newsletter</h4>
                    <p>Dolor amet sit justo amet elitr clita ipsum elitr est.</p>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <input class="form-control border-0 w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                        <button type="button" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">SignUp</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">Your Site Name</a>, All Right Reserved.
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                        Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square rounded-0 back-to-top"><i class="bi bi-arrow-up"></i></a>

    <script>
        function myFunction() {

    }
    </script>



    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/isotope/isotope.pkgd.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
</body>

</html>